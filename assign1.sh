#!/bin/bash

####### Data Collection #######

CURRENTDATE=$(date)

#SYSTEM INFORMATION

MYHOSTNAME=$(hostname)

OPERATINGSYSTEM=$(hostnamectl | grep 'Operating System' | sed 's/.*: //')

UPTIME=$(uptime -p)


#HARDWARE INFORMATION

#CPU_MODEL=$(lscpu | grep -i "Model name" | sed 's/Model name:[[:blank:]]*//;s/@.*//') 
CPU_MODEL=$(sudo lshw -C CPU | grep -Em 2 'vendor|product')

CPU_MAXSPEED=$(sudo dmidecode | grep -I "Max Speed:" | head -n 1 | sed 's/.*Max Speed: //')

CPU_CURRENTSPEED=$(sudo dmidecode | grep -I "Current Speed:" | head -n 1 | sed 's/.*Current Speed: //')

RAM=$(free -h | awk 'FNR==2 {print $2}')

DISKINFO=$(sudo parted -l | grep -Eiw 'Model|Disk /*'| sed 's/^/       /') #Make, Model, and size for all installed disks

#VIDEOCARD=$(sudo lspci | grep 'VGA' | sed 's/.*: //') #Make and Model of video card
VIDEOCARD=$(sudo lshw -C video | grep -E 'vendor|product')

#NETWORK INFORMATION

FQDN=$(hostname --all-fqdns)

HOSTIP=$(hostname -i) #IP address for hostname

GATEWAYIP=$(ip route | grep 'default' | sed 's/.*via.//;s/.dev.*//')

DNSSERVER_IP=$(cat /etc/resolv.conf | grep 'nameserver' | sed 's/nameserver.//') #IP of DNS server

NETWORKCARD=$(sudo lshw -C network | grep -Ei 'vendor|product|logical name') #Make and model of network card

IPADDRESSES=$(ip a | grep -w "global" | awk '{print $9" = "$2}' | sed -z 's/\n/, /g;s/, $//') #IP addresses in CIDR format


#SYSTEM STATUS

USERSLOGGEDIN=$(who | awk '{print $1}' | sed -z 's/\n/, /g;s/, $//')

DISKSPACE=$(df -lh | awk 'FNR>1 { print $6, $4 }'| sed 's/^/       /') #Free space for local filesystems in format: /mountpoint N

PROCESSCOUNT=$(ps -e --no-headers | wc -l)

LOADAVG=$(cat /proc/loadavg | awk '{print $1, $2, $3}' | sed 's/ /, /g')

LISTENINGPORTS=$(sudo ss -lntu | grep -i 'listen' | awk '{print $5}' | sed 's/^.*://' | sed -z 's/\n/, /g;s/, $//')

UFWDATA=$(sudo ufw status | sed 's/^/       /')

#MEMORYALLOCATION

TOTAL_MEMORY=$(free -h | awk 'FNR==2 {print $2}')
USED_MEMORY=$(free -h | awk 'FNR==2 {print $3}')
AVAIL_MEMORY=$(free -h | awk 'FNR==2 {print $7}')
FREE_MEMORY=$(free -h | awk 'FNR==2 {print $4}')

####### Report Template #######

cat<<EOF

System Report generated by $USER on $CURRENTDATE

System Information
------------------
Hostname: $MYHOSTNAME
OS: $OPERATINGSYSTEM
Uptime: $UPTIME

Hardware Information
--------------------
CPU Model:
$CPU_MODEL
CPU Speed: Maximum = $CPU_MAXSPEED, Current = $CPU_CURRENTSPEED 
Total RAM Size: $RAM
Disk Information:
$DISKINFO
VideoCard:
$VIDEOCARD

Network Information
-------------------
FQDN: $FQDN
Host Address: $HOSTIP
Gateway IP: $GATEWAYIP
DNS Server: $DNSSERVER_IP

InterfaceName:
$NETWORKCARD
IP Address(es): $IPADDRESSES

System Status
-------------
Users Logged In: $USERSLOGGEDIN
Disk Space:
       Mountpoint Size
$DISKSPACE
Process Count: $PROCESSCOUNT
Load Averages: $LOADAVG
Memory Allocation:
       Total Memory = $TOTAL_MEMORY
       Used Memory = $USED_MEMORY
       Unused Memory = $FREE_MEMORY
       Available Memory = $AVAIL_MEMORY
Listening Network Ports: $LISTENINGPORTS
Firewall (UFW) Rules:
$UFWDATA
EOF

